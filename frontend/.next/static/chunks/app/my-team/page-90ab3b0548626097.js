(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[960],{6678:(e,t,s)=>{Promise.resolve().then(s.bind(s,898))},6463:(e,t,s)=>{"use strict";var n=s(1169);s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}})},898:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var n=s(7437),a=s(2265),r=s(6463),c=s(2800);function l(e){let{team:t}=e;return(0,n.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("h3",{className:"font-semibold",children:["Team #",t.id]}),(0,n.jsxs)("p",{className:"text-sm text-slate-500",children:["Owner: ",t.user]})]})}),(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsx)("h4",{className:"text-sm font-medium",children:"Fighters"}),(0,n.jsx)("ul",{className:"mt-2 space-y-1",children:t.fighters&&t.fighters.length?t.fighters.map(e=>(0,n.jsx)("li",{className:"text-sm",children:e.name},e.id)):(0,n.jsx)("li",{className:"text-sm text-slate-500",children:"No fighters selected"})})]})]})}var i=s(3508),o=s(357);function u(){let[e,t]=(0,a.useState)([]),[i,u]=(0,a.useState)(!0),[d,m]=(0,a.useState)([]),[h,g]=(0,a.useState)([]),[f,x]=(0,a.useState)(null),[N,p]=(0,a.useState)(null),[v,y]=(0,a.useState)([]),[j,S]=(0,a.useState)(null);return(0,r.useRouter)(),(0,a.useEffect)(()=>{let e=!0;return Promise.resolve().then(s.bind(s,2800)).then(t=>{let{getFighters:s}=t;return s({page:1}).then(t=>{e&&m((t.results?t.results:t)||[])}).catch(()=>{})}),()=>{e=!1}},[]),(0,a.useEffect)(()=>{Promise.resolve().then(s.bind(s,2800)).then(e=>{let{getLeagues:t}=e;return t().then(e=>y(e)).catch(()=>{})})},[]),(0,a.useEffect)(()=>{let e=!0;return(0,c.getTeam)().then(s=>{e&&t(s)}).catch(e=>p(String(e))).finally(()=>u(!1)),()=>{e=!1}},[]),(0,n.jsxs)("div",{className:"p-8",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"My Team"}),i&&(0,n.jsx)("p",{className:"mt-4",children:"Loading teams..."}),N&&(0,n.jsxs)("p",{className:"mt-4 text-red-600",children:["Error: ",N]}),f&&(()=>{let e=s(8873).Z;return(0,n.jsx)(e,{message:f.message,type:f.type,onClose:()=>x(null)})})(),(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Create New Team"}),(0,n.jsxs)("select",{className:"w-full border rounded px-3 py-2 mt-2",value:null!=j?j:"",onChange:e=>S(Number(e.target.value)),children:[(0,n.jsx)("option",{value:"",children:"Select a league"}),v.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("label",{className:"block text-sm font-medium",children:["Select fighters (max ",o.env.NEXT_PUBLIC_TEAM_MAX_ROSTER||5,")"]}),(0,n.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2 max-h-64 overflow-y-auto border rounded p-2",children:d.map(e=>(0,n.jsxs)("label",{className:"flex items-center gap-2 p-1 border rounded",children:[(0,n.jsx)("input",{type:"checkbox",checked:h.includes(e.id),onChange:()=>{let t=Number(o.env.NEXT_PUBLIC_TEAM_MAX_ROSTER||5);if(h.includes(e.id))g(t=>t.filter(t=>t!==e.id));else{if(h.length>=t){x({message:"Max roster size is ".concat(t),type:"error"});return}g(t=>[...t,e.id])}}}),(0,n.jsx)("div",{className:"text-sm",children:e.name})]},e.id))})]}),(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsxs)("div",{className:"text-sm text-slate-600 mb-2",children:["Selected: ",h.length," / ",o.env.NEXT_PUBLIC_TEAM_MAX_ROSTER||5]}),(0,n.jsx)("button",{onClick:async()=>{if(!j)return x({message:"Select a league",type:"error"});let{createTeam:e,getTeam:n}=await Promise.resolve().then(s.bind(s,2800));try{await e(j,h);let s=await n();t(s),x({message:"Team created",type:"success"}),g([])}catch(e){x({message:String(e),type:"error"})}},className:"mt-2 bg-slate-800 text-white px-4 py-2 rounded",disabled:!j||0===h.length||h.length>Number(o.env.NEXT_PUBLIC_TEAM_MAX_ROSTER||5),children:"Create Team"})]})]}),(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"My Teams"}),(0,n.jsx)("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-2",children:e.length?e.map(e=>(0,n.jsx)(l,{team:e},e.id)):(0,n.jsx)("p",{className:"text-slate-600",children:"No teams yet. Create one above!"})})]})]})}function d(){return(0,n.jsx)(i.Z,{children:(0,n.jsx)(u,{})})}},3508:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var n=s(7437),a=s(2265),r=s(6463),c=s(2800);function l(e){let{children:t}=e,[s,l]=(0,a.useState)(!0),i=(0,r.useRouter)();return((0,a.useEffect)(()=>{let e=!0;return(0,c.me)().then(()=>{e&&l(!1)}).catch(()=>{e&&i.push("/login")}),()=>{e=!1}},[i]),s)?(0,n.jsx)("div",{className:"p-8",children:"Checking authentication..."}):(0,n.jsx)(n.Fragment,{children:t})}},8873:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(7437),a=s(2265);function r(e){let{message:t,type:s="info",onClose:r,duration:c=3e3}=e;return(0,a.useEffect)(()=>{let e=setTimeout(()=>r&&r(),c);return()=>clearTimeout(e)},[r,c]),(0,n.jsx)("div",{className:"fixed bottom-6 right-6 ".concat("success"===s?"bg-green-500":"error"===s?"bg-red-500":"bg-slate-600"," text-white px-4 py-2 rounded shadow-lg"),children:t})}},2800:(e,t,s)=>{"use strict";s.r(t),s.d(t,{createLeague:()=>N,createTeam:()=>v,getEvents:()=>m,getFighter:()=>i,getFighters:()=>l,getLeagues:()=>x,getStandings:()=>f,getTeam:()=>h,joinLeague:()=>p,login:()=>o,logout:()=>c,me:()=>d,register:()=>u,setTokens:()=>r,updateTeam:()=>g});let n=s(357).env.NEXT_PUBLIC_API_URL||"http://localhost:8000/api";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={"Content-Type":"application/json"},a=localStorage.getItem("accessToken");a&&(s.Authorization="Bearer ".concat(a));let r=await fetch("".concat(n).concat(e),{credentials:"include",headers:s,...t});if(401===r.status)throw localStorage.removeItem("accessToken"),Error("Unauthorized");if(!r.ok)throw Error(await r.text()||r.statusText);return 204===r.status?null:r.json()}function r(e,t){localStorage.setItem("accessToken",e),t&&localStorage.setItem("refreshToken",t)}function c(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}async function l(e){let t=new URLSearchParams;(null==e?void 0:e.page)&&t.set("page",String(e.page)),(null==e?void 0:e.search)&&t.set("search",e.search);let s=t.toString()?"?".concat(t.toString()):"";return a("/fighters/".concat(s))}async function i(e){return a("/fighters/".concat(e,"/"))}async function o(e,t){let s=await a("/auth/login",{method:"POST",body:JSON.stringify({username:e,password:t})});return s&&s.access&&r(s.access,s.refresh),s}async function u(e,t,s){return a("/auth/register",{method:"POST",body:JSON.stringify({username:e,password:t,email:s})})}async function d(){return a("/auth/me")}async function m(){return a("/events/")}async function h(){return a("/teams/my/")}async function g(e){return a("/teams/update/",{method:"POST",body:JSON.stringify(e)})}async function f(e){return a("/scoring/league/".concat(e,"/"))}async function x(){return a("/leagues/")}async function N(e){return a("/leagues/",{method:"POST",body:JSON.stringify(e)})}async function p(e){return a("/leagues/".concat(e,"/join/"),{method:"POST"})}async function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a("/teams/create/",{method:"POST",body:JSON.stringify({league_id:e,fighter_ids:t})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[130,215,744],()=>t(6678)),_N_E=e.O()}]);