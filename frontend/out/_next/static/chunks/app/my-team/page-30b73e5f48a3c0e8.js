(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[960],{5154:(e,t,s)=>{Promise.resolve().then(s.bind(s,898))},6463:(e,t,s)=>{"use strict";var a=s(1169);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},898:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var a=s(7437),r=s(2265),n=s(2800);function c(e){let{team:t}=e;return(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold",children:["Team #",t.id]}),(0,a.jsxs)("p",{className:"text-sm text-slate-500",children:["Owner: ","string"==typeof t.user?t.user:t.user.username]})]})}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Fighters"}),(0,a.jsx)("ul",{className:"mt-2 space-y-1",children:t.fighters&&t.fighters.length?t.fighters.map(e=>(0,a.jsx)("li",{className:"text-sm",children:e.name},e.id)):(0,a.jsx)("li",{className:"text-sm text-slate-500",children:"No fighters selected"})})]})]})}var i=s(3508),l=s(357);function o(){let[e,t]=(0,r.useState)([]),[i,o]=(0,r.useState)(!0),[u,d]=(0,r.useState)([]),[m,h]=(0,r.useState)([]),[g,f]=(0,r.useState)(null),[x,p]=(0,r.useState)(null),[y,j]=(0,r.useState)([]),[v,N]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=!0;return Promise.resolve().then(s.bind(s,2800)).then(t=>{let{getFighters:s}=t;return s({page:1}).then(t=>{e&&d((t.results?t.results:t)||[])}).catch(()=>{})}),()=>{e=!1}},[]),(0,r.useEffect)(()=>{Promise.resolve().then(s.bind(s,2800)).then(e=>{let{getLeagues:t}=e;return t().then(e=>j(e)).catch(()=>{})})},[]),(0,r.useEffect)(()=>{let e=!0;return(0,n.getTeam)().then(s=>{e&&t(s)}).catch(e=>p(String(e))).finally(()=>o(!1)),()=>{e=!1}},[]);let S=Number(l.env.NEXT_PUBLIC_TEAM_MAX_ROSTER||5);return(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"My Team"}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium",children:["Select fighters (max ",S,")"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2 max-h-64 overflow-y-auto border rounded p-2",children:u.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 p-1 border rounded",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.includes(e.id),onChange:()=>{if(m.includes(e.id))h(t=>t.filter(t=>t!==e.id));else{if(m.length>=S){f({message:"Max roster size is ".concat(S),type:"error"});return}h(t=>[...t,e.id])}}}),(0,a.jsx)("div",{className:"text-sm",children:e.name})]},e.id))}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("div",{className:"text-sm text-slate-600 mb-2",children:["Selected: ",m.length," / ",S]}),(0,a.jsx)("button",{onClick:async()=>{if(!v)return f({message:"Select a league",type:"error"});let{createTeam:e,getTeam:a}=await Promise.resolve().then(s.bind(s,2800));try{await e(v,m);let s=await a();t(s),f({message:"Team created",type:"success"}),h([])}catch(e){f({message:String(e),type:"error"})}},className:"mt-2 bg-slate-800 text-white px-4 py-2 rounded",disabled:!v||0===m.length||m.length>S,children:"Create Team"})]})]}),i&&(0,a.jsx)("p",{className:"mt-4",children:"Loading teams..."}),x&&(0,a.jsxs)("p",{className:"mt-4 text-red-600",children:["Error: ",x]}),g&&(()=>{let e=s(8873).Z;return(0,a.jsx)(e,{message:g.message,type:g.type,onClose:()=>f(null)})})(),(0,a.jsx)("div",{className:"mt-6 grid gap-4 grid-cols-1 md:grid-cols-2",children:e.length?e.map(e=>(0,a.jsx)(c,{team:e},e.id)):(0,a.jsxs)("div",{children:[(0,a.jsxs)("select",{className:"w-full border rounded px-3 py-2 mt-2",value:null!=v?v:"",onChange:e=>N(Number(e.target.value)),children:[(0,a.jsx)("option",{value:"",children:"Select a league"}),y.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("button",{onClick:async()=>{if(!v)return alert("Select a league");let{createTeam:e,getTeam:a}=await Promise.resolve().then(s.bind(s,2800));try{await e(v);let s=await a();t(s),alert("Team created")}catch(e){alert("Failed to create team: "+String(e))}},className:"mt-2 bg-slate-800 text-white px-4 py-2 rounded",children:"Create Team"})})]})})]})}function u(){return(0,a.jsx)(i.Z,{children:(0,a.jsx)(o,{})})}},3508:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var a=s(7437),r=s(2265),n=s(6463),c=s(2800);function i(e){let{children:t}=e,[s,i]=(0,r.useState)(!0),l=(0,n.useRouter)();return((0,r.useEffect)(()=>{let e=!0;return(0,c.me)().then(()=>{e&&i(!1)}).catch(()=>{e&&l.push("/login")}),()=>{e=!1}},[l]),s)?(0,a.jsx)("div",{className:"p-8",children:"Checking authentication..."}):(0,a.jsx)(a.Fragment,{children:t})}},8873:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var a=s(7437),r=s(2265);function n(e){let{message:t,type:s="info",onClose:n,duration:c=3e3}=e;return(0,r.useEffect)(()=>{let e=setTimeout(()=>n&&n(),c);return()=>clearTimeout(e)},[n,c]),(0,a.jsx)("div",{className:"fixed bottom-6 right-6 ".concat("success"===s?"bg-green-500":"error"===s?"bg-red-500":"bg-slate-600"," text-white px-4 py-2 rounded shadow-lg"),children:t})}},2800:(e,t,s)=>{"use strict";s.r(t),s.d(t,{createLeague:()=>p,createTeam:()=>j,getEvents:()=>m,getFighter:()=>l,getFighters:()=>i,getLeagues:()=>x,getStandings:()=>f,getTeam:()=>h,joinLeague:()=>y,login:()=>o,logout:()=>c,me:()=>d,register:()=>u,setTokens:()=>n,updateTeam:()=>g});let a=s(357).env.NEXT_PUBLIC_API_URL||"http://localhost:8000/api";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={"Content-Type":"application/json"},r=localStorage.getItem("accessToken");r&&(s.Authorization="Bearer ".concat(r));let n=await fetch("".concat(a).concat(e),{credentials:"include",headers:s,...t});if(401===n.status)throw localStorage.removeItem("accessToken"),Error("Unauthorized");if(!n.ok)throw Error(await n.text()||n.statusText);return 204===n.status?null:n.json()}function n(e,t){localStorage.setItem("accessToken",e),t&&localStorage.setItem("refreshToken",t)}function c(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}async function i(e){let t=new URLSearchParams;(null==e?void 0:e.page)&&t.set("page",String(e.page)),(null==e?void 0:e.search)&&t.set("search",e.search);let s=t.toString()?"?".concat(t.toString()):"";return r("/fighters/".concat(s))}async function l(e){return r("/fighters/".concat(e,"/"))}async function o(e,t){let s=await r("/auth/login",{method:"POST",body:JSON.stringify({username:e,password:t})});return s&&s.access&&n(s.access,s.refresh),s}async function u(e,t,s){return r("/auth/register",{method:"POST",body:JSON.stringify({username:e,password:t,email:s})})}async function d(){return r("/auth/me")}async function m(){return r("/events/")}async function h(){return r("/teams/my/")}async function g(e){return r("/teams/update/",{method:"POST",body:JSON.stringify(e)})}async function f(e){return r("/scoring/league/".concat(e,"/"))}async function x(){return r("/leagues/")}async function p(e){return r("/leagues/",{method:"POST",body:JSON.stringify(e)})}async function y(e){return r("/leagues/".concat(e,"/join/"),{method:"POST"})}async function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r("/teams/create/",{method:"POST",body:JSON.stringify({league_id:e,fighter_ids:t})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[130,215,744],()=>t(5154)),_N_E=e.O()}]);